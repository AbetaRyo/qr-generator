<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸŸ å…¥å ´ç”¨ QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.5.24/jsrsasign-all-min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 40px; }
    input, button { margin: 8px; padding: 8px; font-size: 15px; }
    pre { background: #f9f9f9; padding: 10px; width: 90%; margin: auto; text-align: left; }
  </style>
</head>
<body>
  <h1>ğŸŸ å…¥å ´ç”¨ QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h1>

  <input type="text" id="user_id" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID"><br>
  <input type="text" id="seat_number" placeholder="åº§å¸­ç•ªå·"><br>
  <button onclick="generateEntryQRCode()">QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ</button>

  <div id="qrcode"></div>
  <pre id="jwtDisplay"></pre>

  <script>
    async function generateEntryQRCode() {
      const user_id = document.getElementById('user_id').value.trim();
      const seat_number = document.getElementById('seat_number').value.trim();
      if (!user_id || !seat_number) return alert("å…¥åŠ›ã—ã¦ãã ã•ã„");

      const device_id = localStorage.getItem('device_id');
      if (!device_id) return alert("è³¼å…¥æ™‚ã®ç«¯æœ«ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„");

      const payload = {
        user_id,
        device_id,
        seat_number,
        iat: KJUR.jws.IntDate.get('now'),
      };
      const header = { alg: "HS256", typ: "JWT" };
      const secret = "your_super_secret_key";
      const jwt = KJUR.jws.JWS.sign(null, JSON.stringify(header), JSON.stringify(payload), secret);

      // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
      const div = document.getElementById('qrcode');
      div.innerHTML = "";
      QRCode.toCanvas(jwt, { width: 300 }, (err, canvas) => div.appendChild(canvas));

      document.getElementById('jwtDisplay').textContent = jwt;
    }
  </script>
</body>
</html>
