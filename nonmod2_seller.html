<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>🏟 入場用 QRコード生成</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.5.24/jsrsasign-all-min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 40px; }
    input, button { margin: 8px; padding: 8px; font-size: 15px; }
    pre { background: #f9f9f9; padding: 10px; width: 90%; margin: auto; text-align: left; }
  </style>
</head>
<body>
  <h1>🏟 入場用 QRコード生成</h1>

  <input type="text" id="user_id" placeholder="ユーザーID"><br>
  <input type="text" id="seat_number" placeholder="座席番号"><br>
  <button onclick="generateEntryQRCode()">QRコードを生成</button>

  <div id="qrcode"></div>
  <pre id="jwtDisplay"></pre>

  <script>
    async function generateEntryQRCode() {
      const user_id = document.getElementById('user_id').value.trim();
      const seat_number = document.getElementById('seat_number').value.trim();
      if (!user_id || !seat_number) return alert("入力してください");

      const device_id = localStorage.getItem('device_id');
      if (!device_id) return alert("購入時の端末でアクセスしてください");

      const payload = {
        user_id,
        device_id,
        seat_number,
        iat: KJUR.jws.IntDate.get('now'),
      };
      const header = { alg: "HS256", typ: "JWT" };
      const secret = "your_super_secret_key";
      const jwt = KJUR.jws.JWS.sign(null, JSON.stringify(header), JSON.stringify(payload), secret);

      // QRコード生成
      const div = document.getElementById('qrcode');
      div.innerHTML = "";
      QRCode.toCanvas(jwt, { width: 300 }, (err, canvas) => div.appendChild(canvas));

      document.getElementById('jwtDisplay').textContent = jwt;
    }
  </script>
</body>
</html>
